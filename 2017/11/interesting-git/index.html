<!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3"><link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222"><meta name="keywords" content="original,"><meta name="description" content="猫猫的博客好久没有写新的文章了，终于下决心把 hexo 更新了一下，发现 Next 主题有个新的样式，还挺好看的。 平时用 git 用得比较多，这里介绍一下 git 的一个好玩的东西，那就是对 Git 根提交的研究。这些东西虽然在平时的版本控制中都不太会用到，但是猫猫也是以根提交为引子，解决一些实际问题，从而理解一些 git 的原理。当然啦，git 要配合 GitHub 使用才能达到最佳效果，有些"><meta name="keywords" content="original"><meta property="og:type" content="article"><meta property="og:title" content="【猫猫教程】特别篇 有趣的Git根提交"><meta property="og:url" content="https://maomihz.com/2017/11/interesting-git/index.html"><meta property="og:site_name" content="Maomi&#39;s Blog"><meta property="og:description" content="猫猫的博客好久没有写新的文章了，终于下决心把 hexo 更新了一下，发现 Next 主题有个新的样式，还挺好看的。 平时用 git 用得比较多，这里介绍一下 git 的一个好玩的东西，那就是对 Git 根提交的研究。这些东西虽然在平时的版本控制中都不太会用到，但是猫猫也是以根提交为引子，解决一些实际问题，从而理解一些 git 的原理。当然啦，git 要配合 GitHub 使用才能达到最佳效果，有些"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://maomihz.com/2017/11/interesting-git/01.png"><meta property="og:image" content="https://maomihz.com/2017/11/interesting-git/02.png"><meta property="og:updated_time" content="2018-01-01T17:04:28.457Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="【猫猫教程】特别篇 有趣的Git根提交"><meta name="twitter:description" content="猫猫的博客好久没有写新的文章了，终于下决心把 hexo 更新了一下，发现 Next 主题有个新的样式，还挺好看的。 平时用 git 用得比较多，这里介绍一下 git 的一个好玩的东西，那就是对 Git 根提交的研究。这些东西虽然在平时的版本控制中都不太会用到，但是猫猫也是以根提交为引子，解决一些实际问题，从而理解一些 git 的原理。当然啦，git 要配合 GitHub 使用才能达到最佳效果，有些"><meta name="twitter:image" content="https://maomihz.com/2017/11/interesting-git/01.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"5.1.3",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://maomihz.com/2017/11/interesting-git/"><title>【猫猫教程】特别篇 有趣的Git根提交 | Maomi's Blog</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Maomi's Blog</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://maomihz.com/2017/11/interesting-git/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="MaomiHz"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Maomi's Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">【猫猫教程】特别篇 有趣的Git根提交</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-08T09:31:10+00:00">2017-11-08</time></span> <span class="post-comments-count"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span><a href="/2017/11/interesting-git/#comments" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/11/interesting-git/" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><script src="/assets/js/APlayer.min.js"></script><p>猫猫的博客好久没有写新的文章了，终于下决心把 hexo 更新了一下，发现 Next 主题有个新的样式，还挺好看的。</p><p>平时用 git 用得比较多，这里介绍一下 git 的一个好玩的东西，那就是对 Git 根提交的研究。这些东西虽然在平时的版本控制中都不太会用到，但是猫猫也是以根提交为引子，解决一些实际问题，从而理解一些 git 的原理。当然啦，git 要配合 GitHub 使用才能达到最佳效果，有些时候特别有用哦！</p><a id="more"></a><h2 id="1-假装在github上删除项目"><a class="markdownIt-Anchor" href="#1-假装在github上删除项目"></a> 1. 假装在GitHub上删除项目</h2><p>当 Shadowsocks 被查封时，Shadowsocks官方的仓库就被完全删除，并且只显示了 Removed According to regulation. 但是呢，软件的开发还在继续进行，只不过一眼看不见，master分支被藏起来了。这是怎么做到的呢？</p> <img src="/2017/11/interesting-git/01.png" title="Shadowsocks"><p>首先我们要创建一个没有parent的分支，将新的提交作为我们的初始提交。这里要说明的是，git 仓库内所有的提交对象都以分开的 object 存储，每个提交都有一个或多个父提交 (parent) ，而分支游标指向某个最新的提交。这个最新的提交指向前一个提交，前一个提交又指向再前一个提交，一直指向根提交，也就是没有父提交的提交。（假如你不知道分支游标是啥，快回去学习git基础吧！）</p><p>所以呢，在同一个git仓库里其实可以拥有多个根提交，只要有其中一个分支游标能够追踪到那个提交，那么这个提交就是有效的提交。正常情况下我们创建一个分支，我们使用的是 <code>git branch</code> 命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git branch new</span><br><span class="line"></span><br><span class="line">$ git branch</span><br><span class="line">* master</span><br><span class="line">  new</span><br><span class="line"></span><br><span class="line">$ git checkout new</span><br><span class="line">Switched to branch &apos;new&apos;</span><br></pre></td></tr></table></figure><p>上面命令创建的 <code>new</code> 分支是指向当前 <code>HEAD</code> 所指向的提交的，刚创建就已经指向了一个提交。假如要创建一个分支指向一个不同的提交，<code>git branch</code> 命令后面也可以接上任意分支名。下面的命令创建了一个新的分支，指向<code>HEAD</code>前一次提交。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch new HEAD^</span><br></pre></td></tr></table></figure><p>接下去这次的主角就要登场了：假如我想让新建的分支不指向任何提交呢？那么我在那个分支新创建的提交就没有任何的历史，也就是创建了一个根提交。git有一个很方便的命令可以实现：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout --orphan new</span><br><span class="line">Switched to a new branch &apos;new&apos;</span><br><span class="line"></span><br><span class="line">$ git log</span><br><span class="line">fatal: your current branch &apos;new&apos; does not have any commits yet</span><br></pre></td></tr></table></figure><p><code>git checkout --orphan</code> 就可以创建一个没有历史的新的分支，并且切换到新分支。这个时候运行 <code>log</code> 可以发现，新的分支没有任何历史记录。</p><p>这时候<code>git status</code> 会输出什么呢？</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch new</span><br><span class="line"></span><br><span class="line">No commits yet</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">      new file:   Makefile</span><br><span class="line">      new file:   README.md</span><br><span class="line">      ...</span><br></pre></td></tr></table></figure><p>从运行结果来看，我们并没有执行任何<code>git add</code>的操作，但是<code>status</code>却输出了 Changes to be commited。这是怎么回事呢？在运行<code>git checkout</code>的时候，git的暂存区是不会清空的，所以现在的暂存区仍然是上一次提交的暂存区。而<code>HEAD</code>当前没有指向任何提交，所以git认为所有在暂存区里的文件都是将要提交的新文件啦。要创建和原来无关的新分支，<strong>首先要清空暂存区</strong>，这一点千万不能忘记了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git rm -rf \*</span><br><span class="line">rm &apos;Makefile&apos;</span><br><span class="line">rm &apos;README.md&apos;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>所有的文件和暂存区都被清空了（要是只清空暂存区的话只要用<code>git reset</code>就行了），这时候git就恢复到了新创建仓库时的初始状态。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch new</span><br><span class="line"></span><br><span class="line">No commits yet</span><br><span class="line"></span><br><span class="line">nothing to commit (create/copy files and use &quot;git add&quot; to track)</span><br></pre></td></tr></table></figure><p>现在只要在这里创建一个<code>README.md</code>，然后里面写上一行话就行了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ &gt;README.md &lt;&lt;&lt; &apos;Removed according to regulation&apos;</span><br><span class="line"></span><br><span class="line">$ git add .</span><br><span class="line"></span><br><span class="line">$ git commit -m &apos;Deleted&apos;</span><br><span class="line">[new (root-commit) 44fe2a6] Deleted</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 README.md</span><br><span class="line"></span><br><span class="line">$ git --no-pager log --pretty=oneline</span><br><span class="line">44fe2a68a045c97ac7902451d25ba09b1f8358b5 (HEAD -&gt; new) Deleted</span><br></pre></td></tr></table></figure><p>可以看到，commit的时候输出了<code>root-commit</code>的信息，说明创建了一个新的根提交，提交历史也只有这一个提交。上传这个新的分支到远端：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin new</span><br><span class="line">Counting objects: 3, done.</span><br><span class="line">Writing objects: 100% (3/3), 242 bytes | 242.00 KiB/s, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">To example.com:maomihz/Test-Repo.git</span><br><span class="line"> * [new branch]      new -&gt; new</span><br></pre></td></tr></table></figure><p>接下来只要在Github上设置将新建的分支设置成默认分支，就可以假装仓库被删除啦！</p> <img src="/2017/11/interesting-git/02.png" title="切换默认分支"><p>切回<code>master</code>分支，所有的文件都回来了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">Switched to branch &apos;master&apos;</span><br><span class="line">Your branch is up to date with &apos;origin/master&apos;.</span><br></pre></td></tr></table></figure><h2 id="2-删除所有的提交历史"><a class="markdownIt-Anchor" href="#2-删除所有的提交历史"></a> 2. 删除所有的提交历史</h2><p>有时候我们想删除所有之前的提交，只保留最新的提交。当然对于一般的项目，千万不要把历史清空，因为Git的历史是非常重要的。所有的提交都是连在一起的，那么怎么删除所有历史呢？这里同样要用到和上面相似的方法。（假设当前分支为<code>master</code>，假如是其他分支的话一定要替换成对应的分支名，不要不小心把master清空了）</p><p>首先新建一个没有历史的分支：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout --orphan temp-branch</span><br><span class="line">Switched to a new branch &apos;temp-branch&apos;</span><br></pre></td></tr></table></figure><p>然后直接提交就行了，因为暂存区并没有清空：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m &apos;Initial Commit&apos;</span><br><span class="line">[temp-branch (root-commit) 021297a] Initial Commit</span><br><span class="line"> 18 files changed, 1257 insertions(+)</span><br><span class="line"> create mode 100644 Makefile</span><br><span class="line"> create mode 100644 README.md</span><br><span class="line"> ...</span><br></pre></td></tr></table></figure><p>接下来删除原先的<code>master</code>分支，将当前分支变成<code>master</code>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -D master</span><br><span class="line">Deleted branch master (was 0feac0e).</span><br><span class="line"></span><br><span class="line">$ git branch -m master</span><br></pre></td></tr></table></figure><p><code>branch -m</code>的作用是重命名当前分支为master。至此master的提交历史就被清空了。当然啦，假如要把这个提交上传到 Git 远端的话，必须要 <code>--force</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push --force origin master</span><br></pre></td></tr></table></figure><h2 id="3-暴力删除所有的提交历史"><a class="markdownIt-Anchor" href="#3-暴力删除所有的提交历史"></a> 3. 暴力删除所有的提交历史</h2><p>上面介绍的方法还算“正常”，但是创建一个新分支还是有些复杂。那么有没有跟简单（暴力）的办法呢？当然是有的。先复习一下分支游标的知识，最新的提交由<code>HEAD</code>来跟踪，而<code>HEAD</code>指向的其实是一个分支，通过分支游标指向的提交才能确定下一个提交的父提交。那么假如要创建一个没有父提交的提交，只要让<code>HEAD</code>找不到父提交就行了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/HEAD</span><br><span class="line">ref: refs/heads/master</span><br><span class="line"></span><br><span class="line">$ cat .git/refs/heads/master</span><br><span class="line">0feac0e526284700df1de952ed9bec449dd159c4</span><br><span class="line"></span><br><span class="line">$ git cat-file -p 0feac0e526284700df1de952ed9bec449dd159c4</span><br><span class="line">tree 6bad90776d3a2905f76436013d7c843d0e8e4e2d</span><br><span class="line">parent bc92368f653384d638827df40fd8c35c46c2cc7d</span><br><span class="line">author ...</span><br><span class="line">committer ...</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>下面这一行命令可以直接删除<code>master</code>游标：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git update-ref -d refs/heads/master</span><br><span class="line"></span><br><span class="line">$ git log</span><br><span class="line">fatal: your current branch &apos;master&apos; does not have any commits yet</span><br></pre></td></tr></table></figure><p>这时候直接提交，就可以创建一个根提交了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m &apos;Initial Commit&apos;</span><br><span class="line">[master (root-commit) ef895e1] Initial Commit</span><br><span class="line"></span><br><span class="line">$ git --no-pager log --pretty=oneline</span><br><span class="line">ef895e19af61df019168185ad4f7b1a07d5a91e8 (HEAD -&gt; master) Initial Commit</span><br></pre></td></tr></table></figure><p>参考资料：<a href="https://stackoverflow.com/questions/18506456/git-how-to-delete-a-local-ref-branch" target="_blank" rel="noopener">StackOverflow</a></p><h2 id="4-删除不小心引入的大文件"><a class="markdownIt-Anchor" href="#4-删除不小心引入的大文件"></a> 4. 删除不小心引入的大文件</h2><p>上面所讲述的方法又一个非常有用的用途，那就是作为二进制文件的发布。二进制文件可以作为一个orphan分支上传到Github，这样就不会影响到正常的代码。不过注意Github上传还是有限制100M的，不要上传太大的文件了。</p><p>Git不会处理二进制文件。即使每次上传都把老的提交历史清空，目录下的 <code>.git</code> 还是会非常大。没有任何分支游标能够记录这些文件，为什么还是会这么大呢？原来是<code>git reflog</code>的问题。</p><p><code>reflog</code>记录了所有分支的变化历史，假如你不小心<code>reset</code>到了某一个历史点，那么想要反悔的话，<code>reflog</code>就派上用场了。但是呢，<code>reflog</code>也为了保护提交对象，防止了直接删除，直到一个时间点后才会过期。（这个过期的时长是可以更改的）</p><p>假设有以下仓库：（<code>HEAD^</code>引入了一个大文件，而<code>HEAD</code>把大文件删除了）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ git --no-pager log --oneline</span><br><span class="line">45c8e36 (HEAD -&gt; master) Remove Big File</span><br><span class="line">bfa02e4 Update big file</span><br><span class="line">2b487e4 Initial Commit</span><br><span class="line"></span><br><span class="line">$ du -sh .git</span><br><span class="line"> 25M	.git</span><br><span class="line"></span><br><span class="line">$ git update-ref -d refs/heads/master</span><br><span class="line"></span><br><span class="line">$ git commit -m &apos;Remove Big File&apos;</span><br><span class="line">[master (root-commit) 962a0e3] Remove Big File</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 README.md</span><br><span class="line"></span><br><span class="line">$ git --no-pager log --oneline</span><br><span class="line"> 962a0e3 (HEAD -&gt; master) Remove Big File</span><br><span class="line"></span><br><span class="line">$ git --no-pager reflog</span><br><span class="line"> 962a0e3 (HEAD -&gt; master) HEAD@&#123;0&#125;: commit (initial): Remove Big File</span><br><span class="line"> 45c8e36 HEAD@&#123;2&#125;: commit: Remove Big File</span><br><span class="line"> bfa02e4 HEAD@&#123;3&#125;: commit: Update big file</span><br><span class="line"> 2b487e4 HEAD@&#123;4&#125;: commit (initial): Initial Commit</span><br></pre></td></tr></table></figure><p>上面<code>reflog</code>的输出里，特别要注意的是<code>HEAD@{0}</code>和<code>HEAD@{2}</code>这两个提交是不一样的提交：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p HEAD@&#123;0&#125;</span><br><span class="line">tree 8524d1d00c861b1222ea69447c84489d20257a89</span><br><span class="line">author MaomiHz &lt;maomihz@example.com&gt; 1510189988 -0600</span><br><span class="line">committer MaomiHz &lt;maomihz@example.com&gt; 1510189988 -0600</span><br><span class="line"></span><br><span class="line">Remove Big File</span><br></pre></td></tr></table></figure><p>这个最新的提交时没有父提交的，是一个根提交。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p HEAD@&#123;2&#125;</span><br><span class="line">tree 8524d1d00c861b1222ea69447c84489d20257a89</span><br><span class="line">parent bfa02e4cb11a1d493f0997e176fa7ff5fdab16bf</span><br><span class="line">author MaomiHz &lt;maomihz@example.com&gt; 1510189844 -0600</span><br><span class="line">committer MaomiHz &lt;maomihz@example.com&gt; 1510189844 -0600</span><br><span class="line"></span><br><span class="line">Remove Big File</span><br><span class="line"></span><br><span class="line">$ git --no-pager log HEAD@&#123;2&#125; --oneline</span><br><span class="line">45c8e36 Remove Big File</span><br><span class="line">bfa02e4 Update big file</span><br><span class="line">2b487e4 Initial Commit</span><br></pre></td></tr></table></figure><p>而这个提交正是我们删除的提交。可以看到<code>reflog</code>记录了所有的历史，要反悔非常方便。</p><p>那么现在假如用<code>git gc</code>清除提交历史，可不可以呢？</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git gc --prune=now</span><br><span class="line">Counting objects: 8, done.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (6/6), done.</span><br><span class="line">Writing objects: 100% (8/8), done.</span><br><span class="line">Total 8 (delta 2), reused 0 (delta 0)</span><br><span class="line"></span><br><span class="line">$ du -sh .git</span><br><span class="line"> 25M	.git</span><br><span class="line"></span><br><span class="line">$ git --no-pager reflog</span><br><span class="line"> 962a0e3 (HEAD -&gt; master) HEAD@&#123;0&#125;: commit (initial): Remove Big File</span><br><span class="line"> 45c8e36 HEAD@&#123;2&#125;: commit: Remove Big File</span><br><span class="line"> bfa02e4 HEAD@&#123;3&#125;: commit: Update big file</span><br><span class="line"> 2b487e4 HEAD@&#123;4&#125;: commit (initial): Initial Commit</span><br></pre></td></tr></table></figure><p>显然不可以，因为<code>reflog</code>还没有过期，不会自动清理这些没有追踪到的提交。要删除它们，必须让reflog过期：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git reflog expire --expire-unreachable=now HEAD</span><br><span class="line"></span><br><span class="line">$ git --no-pager reflog</span><br><span class="line">962a0e3 (HEAD -&gt; master) HEAD@&#123;0&#125;: commit (initial): Remove Big File</span><br></pre></td></tr></table></figure><p><code>HEAD</code>的<code>reflog</code>不见了！这时候再使用<code>git gc</code>，这些对象就会被清除了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git gc --prune=now</span><br><span class="line">Counting objects: 3, done.</span><br><span class="line">Writing objects: 100% (3/3), done.</span><br><span class="line">Total 3 (delta 0), reused 2 (delta 0)</span><br><span class="line"></span><br><span class="line">$ du -sh .git</span><br><span class="line"> 96K	.git</span><br></pre></td></tr></table></figure><p>假如要清除所有的引用不到的对象，可以用<code>--all</code>参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git reflog expire --expire-unreachable=now --all</span><br></pre></td></tr></table></figure><p>参考资料：<a href="https://stackoverflow.com/questions/1904860/how-to-remove-unreferenced-blobs-from-my-git-repo" target="_blank" rel="noopener">StackOverflow</a></p><h2 id="5-复杂地清除提交历史"><a class="markdownIt-Anchor" href="#5-复杂地清除提交历史"></a> 5. 复杂地清除提交历史</h2><p>在Git的老版本中，<code>git checkout --orphan</code>这个命令是没有的。不使用暴力删除的方法，如何才能删除所有提交历史呢？（实际上这用起来并不方便，但是借此机会来探究一下git内部原理）</p><p>我们平时<code>git commit</code>的时候，到底是做了什么呢？回忆Git中有四种对象类型，<code>blob</code>,<code>commit</code>,<code>tag</code>和<code>tree</code>。blob用来存储文件，commit用来存储提交，而tree用来存储目录结构。分支游标指向commit，commit指向tree，而tree又指向任意个tree或blob。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p HEAD</span><br><span class="line">tree 6bad90776d3a2905f76436013d7c843d0e8e4e2d</span><br><span class="line">parent bc92368f653384d638827df40fd8c35c46c2cc7d</span><br><span class="line">author MaomiHz &lt;maomihz@example.com&gt; 1510115667 -0600</span><br><span class="line">committer MaomiHz &lt;maomihz@example.com&gt; 1510115667 -0600</span><br><span class="line"></span><br><span class="line">Commit Message</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ git cat-file -p HEAD^&#123;tree&#125;</span><br><span class="line">100644 blob aea384dbe080bad4b003074dffdf74bf62135876	Makefile</span><br><span class="line">100644 blob d52fadf1e399e8a1703de207b6c4c1de821136ca	README.md</span><br><span class="line">... 其他文件</span><br><span class="line">040000 tree fda5e098305aa6d8b396f10f41cec41d4dbebc8d	src</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ git cat-file -p HEAD:Makefile</span><br><span class="line">CC = g++</span><br><span class="line">SRCS = $(wildcard src/*.cpp)</span><br><span class="line">OBJS = $(notdir $&#123;SRCS:.cpp=.o&#125;)</span><br><span class="line">... 文件内容</span><br></pre></td></tr></table></figure><p>git的暂存区也是一个特殊的tree（是一个临时的tree，并没有写入到版本库内）。默认git记录暂存区文件是<code>.git/index</code>，这是一个二进制文件，不能直接查看，使用<code>ls-files</code>可以显示暂存区内的文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git ls-files -s</span><br><span class="line">100644 aea384dbe080bad4b003074dffdf74bf62135876 0	Makefile</span><br><span class="line">100644 d52fadf1e399e8a1703de207b6c4c1de821136ca 0	README.md</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>假如要丢弃所有历史的话，只要手动将暂存区的内容生成提交，并且不指定父提交就行了。上面第一个命令显示了HEAD所指向的树<code>6bad90776d3a2905f76436013d7c843d0e8e4e2d</code>，记住这个ID：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git commit-tree 6bad9077 &lt;&lt;&lt; &apos;Initial Commit&apos;</span><br><span class="line">4f3126e4c05e5eaec9dfafa3d4298041986c7edd</span><br></pre></td></tr></table></figure><p><code>git commit-tree</code>命令将一个tree生成一个提交对象，而提交信息则是标准输入，并且打印出生成提交的ID。<code>-p</code>参数用来指定生成的父提交，这里没写就是一个根提交啦。</p><p>研究一下新生成的提交对象：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 4f3126e4c05e5eaec9d</span><br><span class="line">tree 6bad90776d3a2905f76436013d7c843d0e8e4e2d</span><br><span class="line">author MaomiHz &lt;maomihz@example.com&gt; 1510192342 -0600</span><br><span class="line">committer MaomiHz &lt;maomihz@example.com&gt; 1510192342 -0600</span><br><span class="line"></span><br><span class="line">Initial Commit</span><br><span class="line"></span><br><span class="line">$ git --no-pager log --oneline 4f3126e4c05e5eaec9d</span><br><span class="line">4f3126e Initial Commit</span><br></pre></td></tr></table></figure><p>果然没有父提交。</p><p>这下只要将<code>master</code>分支接到这个提交上，就可以丢弃master历史啦。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard 4f3126e4c05e5eaec9d</span><br><span class="line">HEAD is now at 4f3126e Initial Commit</span><br><span class="line"></span><br><span class="line">$ git --no-pager log --oneline</span><br><span class="line">4f3126e (HEAD -&gt; master) Initial Commit</span><br></pre></td></tr></table></figure><h2 id="6-复杂地生成orphan分支"><a class="markdownIt-Anchor" href="#6-复杂地生成orphan分支"></a> 6. 复杂地生成orphan分支</h2><p>我们将git内部探索到底，上面讲解了手动直接生成提交而不用<code>commit</code>命令的方法，那么如何生成一个新的和当前分支没有任何关系的分支呢？（也就是复杂版的“假装在GitHub上删除项目”）</p><p>上面说过了，git的暂存区其实就是个临时的tree，是用一个文件来记录的。平时使用的<code>git add</code>其实是首先计算文件的hash，然后将文件写入版本库（这里千万注意，虽然暂存区不写入版本库，但是它不记录文件信息，暂存区内的文件必须要先写入对象库！），然后将文件的hash写入暂存区文件内。</p><p>正常情况下暂存区文件所写的就是最新提交的文件，而新建空分支的话就要一个空的暂存区。git可以通过修改环境，临时指定一个新的暂存区文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ export GIT_INDEX_FILE=/tmp/tmp_index</span><br><span class="line"></span><br><span class="line">$ git ls-files -s</span><br></pre></td></tr></table></figure><p>可以看到没有任何输出。我们设想的新分支里有一个<code>README.md</code>，里面写一段话，那么就先创建这个文件（不管工作区内的文件还没删除）。既然要将git探索到底，这个文件的文件名也随意：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ echo &quot;Removed according to regulation&quot; &gt;future_readme.txt</span><br><span class="line"></span><br><span class="line">$ cat future_readme.txt</span><br><span class="line">Removed according to regulation</span><br></pre></td></tr></table></figure><p>首先先要把计算这个文件的hash，并且写入版本库：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git hash-object -w future_readme.txt</span><br><span class="line">92527cd20e1594337af8404bdbe78384b10e2000</span><br><span class="line"></span><br><span class="line">$ git cat-file -p 92527cd20e1594337af8404</span><br><span class="line">Removed according to regulation</span><br></pre></td></tr></table></figure><p><code>-w</code> 表示写入版本库，默认是只计算hash不写入版本库。blob对象只包含这个文件的内容，不包含任何其他信息，这个文件的文件名是记录在tree里的，所以我们不需要管文件名是什么。（计算机上任意地方的文件都可以通过这个方法写入到版本库内）</p><p>接下来就是将这个文件的内容写入到暂存区内：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git update-index --add --cacheinfo 100644 92527cd20e1594337af8404bdbe78384b10e2000 README.md</span><br><span class="line"></span><br><span class="line">$ git ls-files -s</span><br><span class="line">100644 92527cd20e1594337af8404bdbe78384b10e2000 0	README.md</span><br></pre></td></tr></table></figure><p><code>--cacheinfo</code>的三个参数分别是权限、对象ID和文件名。</p><p>将这个临时的树转成真正的tree对象并写入版本库：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git write-tree</span><br><span class="line">8524d1d00c861b1222ea69447c84489d20257a89</span><br></pre></td></tr></table></figure><p>成功获得了一个tree对象！这下只要提交就行了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ git commit-tree 8524d1d00c861b1222ea6944 &lt;&lt;&lt; Removed</span><br><span class="line">a56605cec2826bda4b9834b88d6b8d10f593ab40</span><br><span class="line"></span><br><span class="line">$ git --no-pager show a56605cec282</span><br><span class="line">commit a56605cec2826bda4b9834b88d6b8d10f593ab40</span><br><span class="line">Author: MaomiHz &lt;maomihz@example.com&gt;</span><br><span class="line">Date:   Wed Nov 8 20:28:26 2017 -0600</span><br><span class="line"></span><br><span class="line">    Removed</span><br><span class="line"></span><br><span class="line">diff --git a/README.md b/README.md</span><br><span class="line">new file mode 100644</span><br><span class="line">index 0000000..92527cd</span><br><span class="line">--- /dev/null</span><br><span class="line">+++ b/README.md</span><br><span class="line">@@ -0,0 +1 @@</span><br><span class="line">+Removed according to regulation</span><br></pre></td></tr></table></figure><p>文件内容果然写入了！最后创建一个分支来记录这个新的提交：（将暂存区还原吧，之前的暂存区没有受到任何影响）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ unset GIT_INDEX_FILE</span><br><span class="line"></span><br><span class="line">$ git clean -xfd</span><br><span class="line">Removing future_readme.txt</span><br><span class="line"></span><br><span class="line">$ git branch rm a56605cec282</span><br><span class="line"></span><br><span class="line">$ git checkout rm</span><br><span class="line">Switched to branch &apos;rm&apos;</span><br><span class="line"></span><br><span class="line">$ ls -l</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r--  1 maomi  staff  32 Nov  8 20:33 README.md</span><br></pre></td></tr></table></figure><p>从未存在过的<code>README.md</code>出现了。</p><p>参考资料：<a href="https://git-scm.com/book/en/v2/Git-Internals-Git-Objects" target="_blank" rel="noopener">Git Book</a></p><h2 id="结语"><a class="markdownIt-Anchor" href="#结语"></a> 结语</h2><p>猫猫从Shadowsocks讲起，仔细研究了git生成提交的过程，希望大家在这之间都能学到一些东西，更深入了解Git。orphan提交也是非常有用的只是，不仅是假装删除，还可以作为Github Pages的源码和生成的html完全分开，或者创建一个新的分支用于存放二进制发布文件。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> MaomiHz</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://maomihz.com/2017/11/interesting-git/" title="【猫猫教程】特别篇 有趣的Git根提交">https://maomihz.com/2017/11/interesting-git/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/original/" rel="tag"># original</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/01/cat-url-shortener/" rel="next" title="【原创】Introducing 猫猫短链接"><i class="fa fa-chevron-left"></i> 【原创】Introducing 猫猫短链接</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2017/12/empty-certificate/" rel="prev" title="How to generate an empty certificate with OpenSSL">How to generate an empty certificate with OpenSSL<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div id="disqus_thread"><noscript> Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">MaomiHz</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">19</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">3</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">4</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/maomihz" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://twitter.com/maomihz" target="_blank" title="Twitter"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-globe"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://leaferx.online/" title="LEAFER x Lab" target="_blank">LEAFER x Lab</a></li><li class="links-of-blogroll-item"> <a href="http://hisenz.com/" title="Hisen Zhang" target="_blank">Hisen Zhang</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-假装在github上删除项目"><span class="nav-number">1.</span> <span class="nav-text">1. 假装在GitHub上删除项目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-删除所有的提交历史"><span class="nav-number">2.</span> <span class="nav-text">2. 删除所有的提交历史</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-暴力删除所有的提交历史"><span class="nav-number">3.</span> <span class="nav-text">3. 暴力删除所有的提交历史</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-删除不小心引入的大文件"><span class="nav-number">4.</span> <span class="nav-text">4. 删除不小心引入的大文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-复杂地清除提交历史"><span class="nav-number">5.</span> <span class="nav-text">5. 复杂地清除提交历史</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-复杂地生成orphan分支"><span class="nav-number">6.</span> <span class="nav-text">6. 复杂地生成orphan分支</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#结语"><span class="nav-number">7.</span> <span class="nav-text">结语</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">MaomiHz</span></div><div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script><script id="dsq-count-scr" src="https://maomiblog.disqus.com/count.js" async></script><script type="text/javascript">var disqus_config=function(){this.page.url="https://maomihz.com/2017/11/interesting-git/",this.page.identifier="2017/11/interesting-git/",this.page.title="【猫猫教程】特别篇 有趣的Git根提交"},d=document,s=d.createElement("script");s.src="https://maomiblog.disqus.com/embed.js",s.setAttribute("data-timestamp",""+ +new Date),(d.head||d.body).appendChild(s)</script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script></body></html>