!function(e,n){"object"==typeof module&&"object"==typeof module.exports?module.exports=n(e,!0):"function"==typeof define&&define.amd?define(function(){return n(e,!0)}):n(e)}("undefined"!=typeof window?window:this,function(e,n){"use strict";var t=e.document,i=t.documentElement,r=t.body,a=function(e,n){return new a.fn.init(e,n)};a.version="3.3.0",a.fn=a.prototype={version:"3.3.0",constructor:a,context:r,condition:i,routine:["initCond","renderElem","renderJiya","renderHanging","correctBiaodian","renderHWS","substCombLigaWithPUA"],init:function(){return arguments[0]&&(this.context=arguments[0]),arguments[1]&&(this.condition=arguments[1]),this},setRoutine:function(e){return Array.isArray(e)&&(this.routine=e),this},render:function(e){var n=this;return(e=Array.isArray(e)?e:this.routine).forEach(function(e){"string"==typeof e&&"function"==typeof n[e]?n[e]():Array.isArray(e)&&"function"==typeof n[e[0]]&&n[e.shift()].apply(n,e)}),this}},a.fn.init.prototype=a.fn,a.init=function(){return a.init=a().render()};var o={punct:{base:"[…,.;:!?‽_]",sing:"[‐-—…]",middle:"[\\/~\\-&‐-—_]",open:"['\"‘“\\(\\[¡¿⸘«‹‚“„]",close:"['\"”’\\)\\]»›‛”‟]",end:"['\"”’\\)\\]»›‛”‟‼‽⁇-⁉,.;:!?]"},biaodian:{base:"[︰．、，。：；？！ー]",liga:"[—…⋯]",middle:"[·＼／－゠＆・＿]",open:"[「『《〈（〔［｛【〖]",close:"[」』》〉）〕］｝】〗]",end:"[」』》〉）〕］｝】〗︰．、，。：；？！ー]"},hanzi:{base:"[一-鿿㐀-䶵㇀-㇣〇﨎﨏﨑﨓﨔﨟﨡﨣﨤﨧-﨩]|[\ud800-\udbff][\udc00-\udfff]",desc:"[⿰-⿺]",radical:"[⼀-⿕⺀-⻳]"},latin:{base:"[A-Za-z0-9À-ÿĀ-ſƀ-ɏⱠ-Ɀ꜠-ꟿḀ-ỿ]",combine:"[̀-́᷀-᷿]"},ellinika:{base:"[0-9Ͱ-Ͽἀ-῿]",combine:"[̀-᷀ͅ-᷿]"},kirillica:{base:"[0-9Ѐ-҂Ҋ-ӿԀ-ԯꙀ-ꙮ꙾-ꚗ]",combine:"[҃-҉ⷠ-ⷿ꙯-꙽ꚟ]"},kana:{base:"[アイウエオ-ヺあいうえお-ゔゟヿ]|\ud82c[\udc00-\udc01]",small:"[ぁぃぅぇぉァィゥェォっゃゅょゎゕゖッャュョヮヵヶㇰ-ㇿ]",combine:"[゙-゜]",half:"[ｦ-ﾟ]",mark:"[゠ゝゞ・-ヾ]"},eonmun:{base:"[가-힣]",letter:"[ᄀ-ᇿㅏ-ㅣㄱ-ㆎꥠ-ꥼힰ-ퟻ]",half:"[ﾡ-ￜ]"},zhuyin:{base:"[ㄅ-ㄭㆠ-ㆺ]",initial:"[ㄅ-ㄙㄪ-ㄬㆠ-ㆣ]",medial:"[ㄧ-ㄩ]",final:"[ㄚ-ㄩㄭㆤ-ㆳㆸ-ㆺ]",tone:"[˙ˊ˅ˇˋ˪˫]",checked:"[ㆴ-ㆷ][̍͘]?"}},c=function(){var e="[\\x20\\t\\r\\n\\f]",n=o.punct.open,t=(o.punct.close,o.punct.end),i=o.punct.middle,r=o.punct.sing,a=n+"|"+t+"|"+i,c=o.biaodian.open,s=o.biaodian.close,d=o.biaodian.end,u=o.biaodian.middle,l=o.biaodian.liga+"{2}",h=c+"|"+d+"|"+u,p=o.kana.base+o.kana.combine+"?",f=o.kana.small+o.kana.combine+"?",g=o.kana.half,b=o.eonmun.base+"|"+o.eonmun.letter,v=o.eonmun.half,m=o.hanzi.base+"|"+o.hanzi.desc+"|"+o.hanzi.radical+"|"+p,y=o.ellinika.combine,x=o.latin.base+y+"*",E=o.ellinika.base+y+"*",w=o.kirillica.combine,N=o.kirillica.base+w+"*",C=x+"|"+E+"|"+N,T=m+"|(?:"+C+"|['’])+",S=o.zhuyin.initial,L=o.zhuyin.medial,k=o.zhuyin.final,z=o.zhuyin.tone+"|"+o.zhuyin.checked;return{char:{punct:{all:new RegExp("("+a+")","g"),open:new RegExp("("+n+")","g"),end:new RegExp("("+t+")","g"),sing:new RegExp("("+r+")","g")},biaodian:{all:new RegExp("("+h+")","g"),open:new RegExp("("+c+")","g"),close:new RegExp("("+s+")","g"),end:new RegExp("("+d+")","g"),liga:new RegExp("("+l+")","g")},hanzi:new RegExp("("+m+")","g"),latin:new RegExp("("+x+")","ig"),ellinika:new RegExp("("+E+")","ig"),kirillica:new RegExp("("+N+")","ig"),kana:new RegExp("("+p+"|"+f+"|"+g+")","g"),eonmun:new RegExp("("+b+"|"+v+")","g")},group:{biaodian:[new RegExp("(("+h+"){2,})","g"),new RegExp("("+l+c+")","g")],punct:null,hanzi:new RegExp("("+m+")+","g"),western:new RegExp("("+x+"|"+E+"|"+N+"|"+a+")+","ig"),kana:new RegExp("("+p+"|"+f+"|"+g+")+","g"),eonmun:new RegExp("("+b+"|"+v+"|"+a+")+","g")},jinze:{hanging:new RegExp(e+"*([、，。．])(?!"+d+")","ig"),touwei:new RegExp("("+c+"+)("+T+")("+d+"+)","ig"),tou:new RegExp("("+c+"+)("+T+")","ig"),wei:new RegExp("("+T+")("+d+"+)","ig"),middle:new RegExp("("+T+")("+u+")("+T+")","ig")},zhuyin:{form:new RegExp("^˙?("+S+")?("+L+")?("+k+")?("+z+")?$"),diao:new RegExp("("+z+")","g")},hws:{base:[new RegExp("("+m+")("+C+"|"+n+")","ig"),new RegExp("("+C+"|"+t+")("+m+")","ig")],strict:[new RegExp("("+m+")"+e+"?("+C+"|"+n+")","ig"),new RegExp("("+C+"|"+t+")"+e+"?("+m+")","ig")]},"display-as":{"ja-font-for-hant":["查 査","啟 啓","鄉 鄕","值 値","污 汚"],"comb-liga-pua":[["a[̍͘]","󰁡"],["e[̍͘]","󰁥"],["i[̍͘]","󰁩"],["o[̍͘]","󰁯"],["u[̍͘]","󰁵"],["ㆴ[̍͘]","󳆴"],["ㆵ[̍͘]","󳆵"],["ㆶ[̍͘]","󳆶"],["ㆷ[̍͘]","󳆷"]],"comb-liga-vowel":[["a[̍͘]","󰁡"],["e[̍͘]","󰁥"],["i[̍͘]","󰁩"],["o[̍͘]","󰁯"],["u[̍͘]","󰁵"]],"comb-liga-zhuyin":[["ㆴ[̍͘]","󳆴"],["ㆵ[̍͘]","󳆵"],["ㆶ[̍͘]","󳆶"],["ㆷ[̍͘]","󳆷"]]},"inaccurate-char":[["[•‧]","·"],["⋯⋯","……"],["──","——"],["‵","‘"],["′","’"],["‶","“"],["″","”"]]}}();a.UNICODE=o,a.TYPESET=c,a.UNICODE.cjk=a.UNICODE.hanzi,a.UNICODE.greek=a.UNICODE.ellinika,a.UNICODE.cyrillic=a.UNICODE.kirillica,a.UNICODE.hangul=a.UNICODE.eonmun,a.UNICODE.zhuyin.ruyun=a.UNICODE.zhuyin.checked,a.TYPESET.char.cjk=a.TYPESET.char.hanzi,a.TYPESET.char.greek=a.TYPESET.char.ellinika,a.TYPESET.char.cyrillic=a.TYPESET.char.kirillica,a.TYPESET.char.hangul=a.TYPESET.char.eonmun,a.TYPESET.group.hangul=a.TYPESET.group.eonmun,a.TYPESET.group.cjk=a.TYPESET.group.hanzi;var s={id:function(e,n){return(n||t).getElementById(e)},tag:function(e,n){return this.makeArray((n||t).getElementsByTagName(e))},qs:function(e,n){return(n||t).querySelector(e)},qsa:function(e,n){return this.makeArray((n||t).querySelectorAll(e))},parent:function(e,n){return n?function(){if("function"==typeof s.matches){for(;!s.matches(e,n);){if(!e||e===t.documentElement){e=void 0;break}e=e.parentNode}return e}}():e?e.parentNode:void 0},create:function(e,n){var i="!"===e?t.createDocumentFragment():""===e?t.createTextNode(n||""):t.createElement(e);try{n&&(i.className=n)}catch(e){}return i},clone:function(e,n){return e.cloneNode("boolean"!=typeof n||n)},remove:function(e){return e.parentNode.removeChild(e)},setAttr:function(e,n){if("object"==typeof n){var t=n.length;if("object"==typeof n[0]&&"name"in n[0])for(var i=0;i<t;i++)void 0!==n[i].value&&e.setAttribute(n[i].name,n[i].value);else for(var r in n)n.hasOwnProperty(r)&&void 0!==n[r]&&e.setAttribute(r,n[r]);return e}},isElmt:function(e){return e&&e.nodeType===Node.ELEMENT_NODE},isIgnorable:function(e){return!!e&&("WBR"===e.nodeName||e.nodeType===Node.COMMENT_NODE)},makeArray:function(e){return Array.prototype.slice.call(e)},extend:function(e,n){if(("object"==typeof e||"function"==typeof e)&&"object"==typeof n)for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e}},d=function(n){var t=n.NON_INLINE_PROSE,i=n.PRESETS.prose.filterElements,r=(e||{}).document||void 0;function a(e,n,t){var i=Element.prototype,r=i.matches||i.mozMatchesSelector||i.msMatchesSelector||i.webkitMatchesSelector;return e instanceof Element?r.call(e,n):!(!t||!/^[39]$/.test(e.nodeType))}if(void 0===r)throw new Error("Fibre requires a DOM-supported environment.");var o=function(e,n){return new o.fn.init(e,n)};return o.version="0.2.1",o.matches=a,o.fn=o.prototype={constructor:o,version:"0.2.1",finder:[],context:void 0,portionMode:"retain",selector:{},preset:"prose",init:function(e,n){if(n&&(this.preset=null),this.selector={context:null,filter:[],avoid:[],boundary:[]},!e)throw new Error("A context is required for Fibre to initialise.");return e instanceof Node?e instanceof Document?this.context=e.body||e:this.context=e:"string"==typeof e&&(this.context=r.querySelector(e),this.selector.context=e),this},filterFn:function(e){var n=this.selector.filter.join(", ")||"*",t=this.selector.avoid.join(", ")||null,r=a(e,n,!0)&&!a(e,t);return"prose"===this.preset?i(e)&&r:r},boundaryFn:function(e){var n=a(e,this.selector.boundary.join(", ")||null);return"prose"===this.preset?t(e)||n:n},filter:function(e){return"string"==typeof e&&this.selector.filter.push(e),this},endFilter:function(e){return e?this.selector.filter=[]:this.selector.filter.pop(),this},avoid:function(e){return"string"==typeof e&&this.selector.avoid.push(e),this},endAvoid:function(e){return e?this.selector.avoid=[]:this.selector.avoid.pop(),this},addBoundary:function(e){return"string"==typeof e&&this.selector.boundary.push(e),this},removeBoundary:function(){return this.selector.boundary=[],this},setMode:function(e){return this.portionMode="first"===e?"first":"retain",this},replace:function(e,t){var i=this;return i.finder.push(n(i.context,{find:e,replace:t,filterElements:function(e){return i.filterFn(e)},forceContext:function(e){return i.boundaryFn(e)},portionMode:i.portionMode})),i},wrap:function(e,t){var i=this;return i.finder.push(n(i.context,{find:e,wrap:t,filterElements:function(e){return i.filterFn(e)},forceContext:function(e){return i.boundaryFn(e)},portionMode:i.portionMode})),i},revert:function(e){var n=this.finder.length;e=Number(e)||(0===e?Number(0):"all"===e?n:1);if(void 0===n||0===n)return this;e>n&&(e=n);for(var t=e;t>0;t--)this.finder.pop().revert();return this}},o.fn.filterOut=o.fn.avoid,o.fn.init.prototype=o.fn,o}(function(){var e="retain",n=t,i={}.hasOwnProperty;function r(){return function(e,n,t,i,o){if(n&&!n.nodeType&&arguments.length<=2)return!1;var c="function"==typeof t;c&&(s=t,t=function(e,n){return s(e.text,n.startIndex)});var s;var d=a(n,{find:e,wrap:c?null:t,replace:c?t:"$"+(i||"&"),prepMatch:function(e,n){if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(i>0){var t=e[i];e.index+=e[0].indexOf(t),e[0]=t}return e.endIndex=e.index+e[0].length,e.startIndex=e.index,e.index=n,e},filterElements:o});return r.revert=function(){return d.revert()},!0}.apply(null,arguments)||a.apply(null,arguments)}function a(e,n){return new o(e,n)}r.NON_PROSE_ELEMENTS={br:1,hr:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1},r.NON_CONTIGUOUS_PROSE_ELEMENTS={address:1,article:1,aside:1,blockquote:1,dd:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,main:1,nav:1,noscript:1,ol:1,output:1,p:1,pre:1,section:1,ul:1,br:1,li:1,summary:1,dt:1,details:1,rp:1,rt:1,rtc:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1,table:1,tbody:1,thead:1,th:1,tr:1,td:1,caption:1,col:1,tfoot:1,colgroup:1},r.NON_INLINE_PROSE=function(e){return i.call(r.NON_CONTIGUOUS_PROSE_ELEMENTS,e.nodeName.toLowerCase())},r.PRESETS={prose:{forceContext:r.NON_INLINE_PROSE,filterElements:function(e){return!i.call(r.NON_PROSE_ELEMENTS,e.nodeName.toLowerCase())}}},r.Finder=o;function o(n,t){var a=t.preset&&r.PRESETS[t.preset];if(t.portionMode=t.portionMode||e,a)for(var o in a)i.call(a,o)&&!i.call(t,o)&&(t[o]=a[o]);this.node=n,this.options=t,this.prepMatch=t.prepMatch||this.prepMatch,this.reverts=[],this.matches=this.search(),this.matches.length&&this.processMatches()}return o.prototype={search:function(){var e,n=0,t=0,i=this.options.find,r=this.getAggregateText(),a=[],o=this;i="string"==typeof i?RegExp((c=i,String(c).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")),"g"):i;var c;!function r(c){for(var s=0,d=c.length;s<d;++s){var u=c[s];if("string"==typeof u){if(i.global)for(;e=i.exec(u);)a.push(o.prepMatch(e,n++,t));else(e=u.match(i))&&a.push(o.prepMatch(e,0,t));t+=u.length}else r(u)}}(r);return a},prepMatch:function(e,n,t){if(!e[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");return e.endIndex=t+e.index+e[0].length,e.startIndex=t+e.index,e.index=n,e},getAggregateText:function(){var e=this.options.filterElements,n=this.options.forceContext;return function t(i,r){if(3===i.nodeType)return[i.data];if(e&&!e(i))return[];var r=[""];var a=0;if(i=i.firstChild)do{if(3!==i.nodeType){var o=t(i);n&&1===i.nodeType&&(!0===n||n(i))?(r[++a]=o,r[++a]=""):("string"==typeof o[0]&&(r[a]+=o.shift()),o.length&&(r[++a]=o,r[++a]=""))}else r[a]+=i.data}while(i=i.nextSibling);return r}(this.node)},processMatches:function(){var e,n,t,i=this.matches,r=this.node,a=this.options.filterElements,o=[],c=r,s=i.shift(),d=0,u=0,l=[r];e:for(;;){if(3===c.nodeType&&(!n&&c.length+d>=s.endIndex?n={node:c,index:u++,text:c.data.substring(s.startIndex-d,s.endIndex-d),indexInMatch:d-s.startIndex,indexInNode:s.startIndex-d,endIndexInNode:s.endIndex-d,isEnd:!0}:e&&o.push({node:c,index:u++,text:c.data,indexInMatch:d-s.startIndex,indexInNode:0}),!e&&c.length+d>s.startIndex&&(e={node:c,index:u++,indexInMatch:0,indexInNode:s.startIndex-d,endIndexInNode:s.endIndex-d,text:c.data.substring(s.startIndex-d,s.endIndex-d)}),d+=c.data.length),t=1===c.nodeType&&a&&!a(c),e&&n){if(c=this.replaceMatch(s,e,o,n),d-=n.node.data.length-n.endIndexInNode,e=null,n=null,o=[],u=0,0,!(s=i.shift()))break}else if(!t&&(c.firstChild||c.nextSibling)){c.firstChild?(l.push(c),c=c.firstChild):c=c.nextSibling;continue}for(;;){if(c.nextSibling){c=c.nextSibling;break}if((c=l.pop())===r)break e}}},revert:function(){for(var e=this.reverts.length;e--;)this.reverts[e]();this.reverts=[]},prepareReplacementString:function(e,n,t,i){var r=this.options.portionMode;return"first"===r&&n.indexInMatch>0?"":(e=e.replace(/\$(\d+|&|`|')/g,function(e,n){var i;switch(n){case"&":i=t[0];break;case"`":i=t.input.substring(0,t.startIndex);break;case"'":i=t.input.substring(t.endIndex);break;default:i=t[+n]}return i}),"first"===r?e:n.isEnd?e.substring(n.indexInMatch):e.substring(n.indexInMatch,n.indexInMatch+n.text.length))},getPortionReplacementNode:function(e,t,i){var r=this.options.replace||"$&",a=this.options.wrap;if(a&&a.nodeType){var o=n.createElement("div");o.innerHTML=a.outerHTML||(new XMLSerializer).serializeToString(a),a=o.firstChild}if("function"==typeof r)return(r=r(e,t,i))&&r.nodeType?r:n.createTextNode(String(r));var c="string"==typeof a?n.createElement(a):a;return(r=n.createTextNode(this.prepareReplacementString(r,e,t,i))).data&&c?(c.appendChild(r),c):r},replaceMatch:function(e,t,i,r){var a,o,c=t.node,s=r.node;if(c===s){var d=c;t.indexInNode>0&&(a=n.createTextNode(d.data.substring(0,t.indexInNode)),d.parentNode.insertBefore(a,d));var u=this.getPortionReplacementNode(r,e);return d.parentNode.insertBefore(u,d),r.endIndexInNode<d.length&&(o=n.createTextNode(d.data.substring(r.endIndexInNode)),d.parentNode.insertBefore(o,d)),d.parentNode.removeChild(d),this.reverts.push(function(){a===u.previousSibling&&a.parentNode.removeChild(a),o===u.nextSibling&&o.parentNode.removeChild(o),u.parentNode.replaceChild(d,u)}),u}a=n.createTextNode(c.data.substring(0,t.indexInNode)),o=n.createTextNode(s.data.substring(r.endIndexInNode));for(var l=this.getPortionReplacementNode(t,e),h=[],p=0,f=i.length;p<f;++p){var g=i[p],b=this.getPortionReplacementNode(g,e);g.node.parentNode.replaceChild(b,g.node),this.reverts.push(function(e,n){return function(){n.parentNode.replaceChild(e.node,n)}}(g,b)),h.push(b)}var v=this.getPortionReplacementNode(r,e);return c.parentNode.insertBefore(a,c),c.parentNode.insertBefore(l,c),c.parentNode.removeChild(c),s.parentNode.insertBefore(v,s),s.parentNode.insertBefore(o,s),s.parentNode.removeChild(s),this.reverts.push(function(){a.parentNode.removeChild(a),l.parentNode.replaceChild(c,l),o.parentNode.removeChild(o),v.parentNode.replaceChild(s,v)}),v}},r}()),u=function(){var e=s.create("div");return e.appendChild(s.create("","0-")),e.appendChild(s.create("","2")),e.normalize(),2!==e.firstChild.length}();function l(e){return"function"==typeof e||e instanceof Element?e:void 0}function h(e){var n=0===e.index&&e.isEnd?"biaodian cjk":"biaodian cjk portion "+(0===e.index?"is-first":e.isEnd?"is-end":"is-inner"),t=s.create("h-char-group",n);return t.innerHTML=e.text,t}function p(e){var n=s.create("div"),t=e.charCodeAt(0).toString(16);n.innerHTML='<h-char unicode="'+t+'" class="biaodian cjk '+(i=e,i.match(c.char.biaodian.open)?"bd-open":i.match(c.char.biaodian.close)?"bd-close bd-end":i.match(c.char.biaodian.end)?/(?:\u3001|\u3002|\uff0c)/i.test(i)?"bd-end bd-cop":"bd-end":i.match(new RegExp(o.biaodian.liga))?"bd-liga":i.match(new RegExp(o.biaodian.middle))?"bd-middle":"")+'">'+e+"</h-char>";var i;return n.firstChild}s.extend(d.fn,{normalize:function(){return u&&this.context.normalize(),this},jinzify:function(e){return this.filter(e||null).avoid("h-jinze").replace(c.jinze.touwei,function(e,n){var t=s.create("h-jinze","touwei");return t.innerHTML=n[0],0===e.index&&e.isEnd||1===e.index?t:""}).replace(c.jinze.wei,function(e,n){var t=s.create("h-jinze","wei");return t.innerHTML=n[0],0===e.index?t:""}).replace(c.jinze.tou,function(e,n){var t=s.create("h-jinze","tou");return t.innerHTML=n[0],0===e.index&&e.isEnd||1===e.index?t:""}).replace(c.jinze.middle,function(e,n){var t=s.create("h-jinze","middle");return t.innerHTML=n[0],0===e.index&&e.isEnd||1===e.index?t:""}).endAvoid().endFilter()},groupify:function(e){e=s.extend({biaodian:!1,hanzi:!1,kana:!1,eonmun:!1,western:!1},e||{});return this.avoid("h-word, h-char-group"),e.biaodian&&this.replace(c.group.biaodian[0],h).replace(c.group.biaodian[1],h),(e.hanzi||e.cjk)&&this.wrap(c.group.hanzi,s.clone(s.create("h-char-group","hanzi cjk"))),e.western&&this.wrap(c.group.western,s.clone(s.create("h-word","western"))),e.kana&&this.wrap(c.group.kana,s.clone(s.create("h-char-group","kana"))),(e.eonmun||e.hangul)&&this.wrap(c.group.eonmun,s.clone(s.create("h-word","eonmun hangul"))),this.endAvoid(),this},charify:function(e){return(e=s.extend({avoid:!0,biaodian:!1,punct:!1,hanzi:!1,latin:!1,ellinika:!1,kirillica:!1,kana:!1,eonmun:!1},e||{})).avoid&&this.avoid("h-char"),e.biaodian&&this.replace(c.char.biaodian.all,l(e.biaodian)||function(e){return p(e.text)}).replace(c.char.biaodian.liga,l(e.biaodian)||function(e){return p(e.text)}),(e.hanzi||e.cjk)&&this.wrap(c.char.hanzi,l(e.hanzi||e.cjk)||s.clone(s.create("h-char","hanzi cjk"))),e.punct&&this.wrap(c.char.punct.all,l(e.punct)||s.clone(s.create("h-char","punct"))),e.latin&&this.wrap(c.char.latin,l(e.latin)||s.clone(s.create("h-char","alphabet latin"))),(e.ellinika||e.greek)&&this.wrap(c.char.ellinika,l(e.ellinika||e.greek)||s.clone(s.create("h-char","alphabet ellinika greek"))),(e.kirillica||e.cyrillic)&&this.wrap(c.char.kirillica,l(e.kirillica||e.cyrillic)||s.clone(s.create("h-char","alphabet kirillica cyrillic"))),e.kana&&this.wrap(c.char.kana,l(e.kana)||s.clone(s.create("h-char","kana"))),(e.eonmun||e.hangul)&&this.wrap(c.char.eonmun,l(e.eonmun||e.hangul)||s.clone(s.create("h-char","eonmun hangul"))),this.endAvoid(),this}}),s.extend(a,{isNodeNormalizeNormal:u,find:d,createBDGroup:h,createBDChar:p}),s.matches=a.find.matches,["setMode","wrap","replace","revert","addBoundary","removeBoundary","avoid","endAvoid","filter","endFilter","jinzify","groupify","charify"].forEach(function(e){a.fn[e]=function(){return this.finder||(this.finder=a.find(this.context)),this.finder[e](arguments[0],arguments[1]),this}});var f={};function g(e,n){var t,i=s.create("canvas");return i.width="50",i.height="20",i.style.display="none",r.appendChild(i),(t=i.getContext("2d")).textBaseline="top",t.font="15px "+n+", sans-serif",t.fillStyle="black",t.strokeStyle="black",t.fillText(e,0,0),{node:i,context:t,remove:function(){s.remove(i,r)}}}function b(e,n){var t,i=e.context,r=n.context;try{for(var a=1;a<=20;a++)for(var o=1;o<=50;o++){if(void 0===t&&i.getImageData(o,a,1,1).data[3]!==r.getImageData(o,a,1,1).data[3]){t=!1;break}if("boolean"==typeof t)break;50===o&&20===a&&void 0===t&&(t=!0)}return e.remove(),n.remove(),e=null,n=null,t}catch(e){}return!1}f.writeOnCanvas=g,f.compareCanvases=b,f.detectFont=function(e,n,t){return e=e,n=n||"sans-serif",n=g(t=t||"辭Q",n),!b(e=g(t,e),n)},f.support=function(){var n="Webkit Moz ms".split(" "),a=s.create("h-test");function o(e){var t,i=e.charAt(0).toUpperCase()+e.slice(1);return(e+" "+n.join(i+" ")+i).split(" ").forEach(function(e){"string"==typeof a.style[e]&&(t=!0)}),t||!1}function c(e,n){var t,a,o,c=r||s.create("body"),d=s.create("div"),u=r?d:c;n="function"==typeof n?n:function(){};return t=["<style>",e,"</style>"].join(""),u.innerHTML+=t,c.appendChild(d),r||(c.style.background="",c.style.overflow="hidden",o=i.style.overflow,i.style.overflow="hidden",i.appendChild(c)),a=n(u,e),s.remove(u),r||(i.style.overflow=o),!!a}function d(n,i){var r;return e.getComputedStyle?r=t.defaultView.getComputedStyle(n,null).getPropertyValue(i):n.currentStyle&&(r=n.currentStyle[i]),r}return{columnwidth:o("columnWidth"),fontface:function(){var e;return c('@font-face { font-family: font; src: url("//"); }',function(n,t){var i=s.qsa("style",n)[0],r=i.sheet||i.styleSheet,a=r?r.cssRules&&r.cssRules[0]?r.cssRules[0].cssText:r.cssText||"":"";e=/src/i.test(a)&&0===a.indexOf(t.split(" ")[0])}),e}(),ruby:function(){var e,n=s.create("ruby"),t=s.create("rt"),r=s.create("rp");return n.appendChild(r),n.appendChild(t),i.appendChild(n),e="none"===d(r,"display")||"ruby"===d(n,"display")&&"ruby-text"===d(t,"display"),i.removeChild(n),n=null,t=null,r=null,e}(),"ruby-display":function(){var e=s.create("div");return e.innerHTML='<h-test-a style="display: ruby;"></h-test-a><h-test-b style="display: ruby-text-container;"></h-test-b>',"ruby"===e.querySelector("h-test-a").style.display&&"ruby-text-container"===e.querySelector("h-test-b").style.display}(),"ruby-interchar":function(){var e,n="inter-character",t=s.create("div");return t.innerHTML='<h-test style="-moz-ruby-position:'+n+";-ms-ruby-position:"+n+";-webkit-ruby-position:"+n+";ruby-position:"+n+';"></h-test>',(e=t.querySelector("h-test").style).rubyPosition===n||e.WebkitRubyPosition===n||e.MozRubyPosition===n||e.msRubyPosition===n}(),textemphasis:o("textEmphasis"),unicoderange:function(){var e;return c('@font-face{font-family:test-for-unicode-range;src:local(Arial),local("Droid Sans")}@font-face{font-family:test-for-unicode-range;src:local("Times New Roman"),local(Times),local("Droid Serif");unicode-range:U+270C}',function(){e=!f.detectFont("test-for-unicode-range",'Arial, "Droid Sans"',"Q")}),e}(),writingmode:o("writingMode")}}(),f.initCond=function(e){e=e||i;var n,t="";for(var r in f.support)n=(f.support[r]?"":"no-")+r,e.classList.add(n),t+=n+" ";return t};var v=f.support["ruby-interchar"];function m(e){var n,t=s.create("!"),i=e.classList;return t.appendChild(s.clone(e)),s.tag("rt",t.firstChild).forEach(function(e){var t,r=s.create("!"),a=[];do{if(!(t=(t||e).previousSibling)||t.nodeName.match(/((?:h\-)?r[ubt])/i))break;r.insertBefore(s.clone(t),r.firstChild),a.push(t)}while(!t.nodeName.match(/((?:h\-)?r[ubt])/i));n=i.contains("zhuyin")?C(r,e):N(r,e);try{e.parentNode.replaceChild(n,e),a.map(s.remove)}catch(e){}}),E(t)}function y(e){var n=s.create("!");return n.appendChild(s.clone(e)),s.tag("rt",n.firstChild).forEach(function(e){var n,t,i=s.create("!"),r=[];do{if(!(n=(n||e).previousSibling)||n.nodeName.match(/((?:h\-)?r[ubt])/i))break;i.insertBefore(s.clone(n),i.firstChild),r.push(n)}while(!n.nodeName.match(/((?:h\-)?r[ubt])/i));(t=s.create("rt")).innerHTML=T(e),e.parentNode.replaceChild(t,e)}),n.firstChild}function x(e){var n,t,i,r,a=s.create("!"),o=e.classList;a.appendChild(s.clone(e)),n=a.firstChild,t=i=s.tag("rb",n),r=t.length,(c=n.querySelector("rtc.zhuyin"))&&(i=s.tag("rt",c).map(function(e,n){if(t[n]){var i=C(t[n],e);try{t[n].parentNode.replaceChild(i,t[n])}catch(e){}return i}}),s.remove(c),n.setAttribute("rightangle","true"));var c;return s.qsa("rtc:not(.zhuyin)",n).forEach(function(e,t){var a;a=s.tag("rt",e).map(function(e,n){var a,c,d=Number(e.getAttribute("rbspan")||1),u=0,l=[];d>r&&(d=r);do{try{a=i.shift(),l.push(a)}catch(e){}if(void 0===a)break;u+=Number(a.getAttribute("span")||1)}while(d>u);if(d<u){if(l.length>1)return void console.error("An impossible `rbspan` value detected.",ruby);l=s.tag("rb",l[0]),i=l.slice(d).concat(i),l=l.slice(0,d),u=d}c=N(l,e,{class:o,span:u,order:t});try{l[0].parentNode.replaceChild(c,l.shift()),l.map(s.remove)}catch(e){}return c}),i=a,1===t&&n.setAttribute("doubleline","true"),s.remove(e)}),E(a)}function E(e){var n=e.firstChild,t=s.create("h-ruby");return t.innerHTML=n.innerHTML,s.setAttr(t,n.attributes),t.normalize(),t}function w(e){if(!e instanceof Element)return e;var n=e.classList;return n.contains("pinyin")?n.add("romanization"):n.contains("romanization")?n.add("annotation"):n.contains("mps")?n.add("zhuyin"):n.contains("rightangle")&&n.add("complex"),e}function N(e,n,t){var i=s.create("h-ru");n=s.clone(n);return(t=t||{}).annotation="true",Array.isArray(e)?i.innerHTML=e.map(function(e){return void 0===e?"":e.outerHTML}).join("")+n.outerHTML:(i.appendChild(s.clone(e)),i.appendChild(n)),s.setAttr(i,t),i}function C(e,n){e=s.clone(e);var t=s.create("h-ru");return t.setAttribute("zhuyin",!0),t.appendChild(e),t.innerHTML+=T(n),t}function T(e){var n,t,i,r="string"==typeof e?e:e.textContent;return i=(n=r.replace(c.zhuyin.diao,""))?n.length:0,t=r.replace(n,"").replace(/[\u02C5]/g,"ˇ").replace(/[\u030D]/g,"͘"),0===i?"":'<h-zhuyin length="'+i+'" diao="'+t+'"><h-yin>'+n+"</h-yin><h-diao>"+t+"</h-diao></h-zhuyin>"}s.extend(f,{renderRuby:function(e,n){n=n||"ruby";var t=s.qsa(n,e);s.qsa("rtc",e).concat(t).map(w),t.forEach(function(e){var n,t=e.classList;t.contains("complex")?n=x(e):t.contains("zhuyin")&&(n=v?y(e):m(e)),n&&e.parentNode.replaceChild(n,e)})},simplifyRubyClass:w,getZhuyinHTML:T,renderComplexRuby:x,renderSimpleRuby:m,renderInterCharRuby:y}),s.extend(f,{renderElem:function(e){this.renderRuby(e),this.renderDecoLine(e),this.renderDecoLine(e,"s, del"),this.renderEm(e)},renderDecoLine:function(e,n){var t=s.qsa(n||"u, ins",e),i=t.length;e:for(;i--;){var r=t[i],a=null;do{if(!(a=(a||r).previousSibling))continue e;t[i-1]===a&&r.classList.add("adjacent")}while(s.isIgnorable(a))}},renderEm:function(e,n){var t=n?"qsa":"tag";n=n||"em";s[t](n,e).forEach(function(e){var n=a(e);f.support.textemphasis?n.avoid("rt, h-char").charify({biaodian:!0,punct:!0}):n.avoid("rt, h-char, h-char-group").jinzify().groupify({western:!0}).charify({hanzi:!0,biaodian:!0,punct:!0,latin:!0,ellinika:!0,kirillica:!0})})}}),a.normalize=f,a.localize=f,a.support=f.support,a.detectFont=f.detectFont,a.fn.initCond=function(){return this.condition.classList.add("han-js-rendered"),a.normalize.initCond(this.condition),this},["Elem","DecoLine","Em","Ruby"].forEach(function(e){var n="render"+e;a.fn[n]=function(e){return a.normalize[n](this.context,e),this}}),s.extend(a.support,{heiti:!0,songti:a.detectFont('"Han Songti"'),"songti-gb":a.detectFont('"Han Songti GB"'),kaiti:a.detectFont('"Han Kaiti"'),fangsong:a.detectFont('"Han Fangsong"')}),a.correctBiaodian=function(e){e=e||t;var n=a.find(e);return n.avoid("h-char").replace(/([‘“])/g,function(e){var n=a.createBDChar(e.text);return n.classList.add("bd-open","punct"),n}).replace(/([’”])/g,function(e){var n=a.createBDChar(e.text);return n.classList.add("bd-close","bd-end","punct"),n}),a.support.unicoderange?n:n.charify({biaodian:!0})},a.correctBasicBD=a.correctBiaodian,a.correctBD=a.correctBiaodian,s.extend(a.fn,{biaodian:null,correctBiaodian:function(){return this.biaodian=a.correctBiaodian(this.context),this},revertCorrectedBiaodian:function(){try{this.biaodian.revert("all")}catch(e){}return this}}),a.fn.correctBasicBD=a.fn.correctBiaodian,a.fn.revertBasicBD=a.fn.revertCorrectedBiaodian;var S="<<hws>>",L=s.create("h-hws");L.setAttribute("hidden",""),L.innerHTML=" ";function k(e,n){return e.isEnd&&0===e.index?n[1]+S+n[2]:0===e.index?function(e,n){var t=e;if(n=n||"",s.isElmt(e.nextSibling)||(i=e,r=e.nextSibling,i&&r&&i.parentNode===r.parentNode))return n+S;for(;!t.nextSibling;)t=t.parentNode;e!==t&&t.insertAdjacentHTML("afterEnd","<h-hws hidden> </h-hws>");var i,r;return n}(e.node,e.text):e.text}function z(e){return 0===e.index?s.clone(L):""}var I;function M(e){var n=e.node.parentNode;return 0===e.index&&(I=e.endIndexInNode-2),"h-hws"!==n.nodeName.toLowerCase()||1!==e.index&&e.indexInMatch!==I||n.classList.add("quote-inner"),e.text}function R(e){var n=e.node.parentNode;return"h-hws"===n.nodeName.toLowerCase()&&n.classList.add("quote-outer"),e.text}s.extend(a,{renderHWS:function(e,n){var i=n?"textarea, code, kbd, samp, pre":"textarea",r=n?"strict":"base",o=(e=e||t,a.find(e));return o.avoid(i).replace(a.TYPESET.hws[r][0],k).replace(a.TYPESET.hws[r][1],k).replace(new RegExp("("+S+")+","g"),z).replace(/([\'"])\s(.+?)\s\1/g,M).replace(/\s[‘“]/g,R).replace(/[’”]\s/g,R).normalize(),o}}),s.extend(a.fn,{renderHWS:function(e){return a.renderHWS(this.context,e),this},revertHWS:function(){return s.tag("h-hws",this.context).forEach(function(e){s.remove(e)}),this.HWS=[],this}});var j='<h-cs hidden class="jinze-outer hangable-outer"> </h-cs>',A=a.find.matches;function P(){var e,n=s.create("div");return n.innerHTML="<span>a b</span><span style=\"font-family: 'Han Space'\">a b</span>",r.appendChild(n),e=n.firstChild.offsetWidth!==n.lastChild.offsetWidth,s.remove(n),e}a.support["han-space"]=P(),s.extend(a,{detectSpaceFont:P,isSpaceFontLoaded:P(),renderHanging:function(e){e=e||t;var n=a.find(e);return n.avoid("textarea, code, kbd, samp, pre").avoid("h-char.bd-hangable").replace(c.jinze.hanging,function(e){if(/^[\x20\t\r\n\f]+$/.test(e.text))return"";var n,t,i,r,o=e.node.parentNode;return(n=s.parent(o,"h-jinze"))&&function(e){var n=e.nextSibling;n&&A(n,"h-cs.jinze-outer")?n.classList.add("hangable-outer"):e.insertAdjacentHTML("afterend",j)}(n),r=e.text.trim(),(t=a.createBDChar(r)).innerHTML="<h-inner>"+r+"</h-inner>",t.classList.add("bd-hangable"),(i=s.parent(o,"h-char.biaodian"))?(i.classList.add("bd-hangable"),A(o,"h-inner, h-inner *")?r:t.firstChild):t}),n}}),s.extend(a.fn,{renderHanging:function(){var e=this.condition.classList;return a.isSpaceFontLoaded=P(),a.isSpaceFontLoaded&&e.contains("no-han-space")&&(e.remove("no-han-space"),e.add("han-space")),a.renderHanging(this.context),this},revertHanging:function(){return s.qsa("h-char.bd-hangable, h-cs.hangable-outer",this.context).forEach(function(e){var n=e.classList;n.remove("bd-hangable"),n.remove("hangable-outer")}),this}});var H="bd-jiya",O="bd-consecutive",B='<h-cs hidden class="jinze-outer jiya-outer"> </h-cs>';A=a.find.matches;function D(e){return e.replace(/(biaodian|cjk|bd-jiya|bd-consecutive|bd-hangable)/gi,"").trim()}function F(e){var n,t=e.text,i=e.node.parentNode,r=s.parent(i,"h-char.biaodian"),o=a.createBDChar(t);return o.innerHTML="<h-inner>"+t+"</h-inner>",o.classList.add(H),(n=s.parent(i,"h-jinze"))&&function(e){A(e,".tou, .touwei")&&!A(e.previousSibling,"h-cs.jiya-outer")&&e.insertAdjacentHTML("beforebegin",B);A(e,".wei, .touwei")&&!A(e.nextSibling,"h-cs.jiya-outer")&&e.insertAdjacentHTML("afterend",B)}(n),r?(r.classList.add(H),A(i,"h-inner, h-inner *")?t:o.firstChild):o}var q,U;function _(e){var n,t=q,i=e.node.parentNode,r=s.parent(i,"h-char.biaodian"),a=s.parent(r,"h-jinze");return n=r.classList,t&&r.setAttribute("prev",t),U&&n.contains("bd-open")&&U.pop().setAttribute("next","bd-open"),U=void 0,e.isEnd?(q=void 0,n.add(O,"end-portion")):(q=D(r.getAttribute("class")),n.add(O)),a&&(U=function(e,n){var t,i;A(e,".tou, .touwei")&&(t=e.previousSibling,A(t,"h-cs")&&(t.className="jinze-outer jiya-outer",t.setAttribute("prev",n.prev)));A(e,".wei, .touwei")&&(i=e.nextSibling,A(i,"h-cs")&&(i.className="jinze-outer jiya-outer "+n.class,i.removeAttribute("prev")));return[t,i]}(a,{prev:t,class:D(r.getAttribute("class"))})),e.text}a.renderJiya=function(e){e=e||t;var n=a.find(e);return n.avoid("textarea, code, kbd, samp, pre, h-cs").avoid("h-char.bd-jiya").charify({avoid:!1,biaodian:F}).endAvoid().avoid("textarea, code, kbd, samp, pre, h-cs").replace(c.group.biaodian[0],_).replace(c.group.biaodian[1],_),n},s.extend(a.fn,{renderJiya:function(){return a.renderJiya(this.context),this},revertJiya:function(){return s.qsa("h-char.bd-jiya, h-cs.jiya-outer",this.context).forEach(function(e){var n=e.classList;n.remove("bd-jiya"),n.remove("jiya-outer")}),this}});var Y="textarea, code, kbd, samp, pre";function W(e,n,t){return function(){var i=a.localize.writeOnCanvas(n,e),r=a.localize.writeOnCanvas(t,e);return a.localize.compareCanvases(i,r)}}function V(){return W('"Romanization Sans"',"i̍","󰁩")}function Z(e){return function(n){n=n||t;var i=a.find(n).avoid(Y);return e.forEach(function(e){i.replace(new RegExp(e[0],"ig"),function(n,t){var i=s.clone($);return i.innerHTML="<h-inner>"+t[0]+"</h-inner>",i.setAttribute("display-as",e[1]),0===n.index?i:""})}),i}}var $=s.create("h-char","comb-liga");return s.extend(a,{isVowelCombLigaNormal:W('"Romanization Sans"',"a̍","󰁡"),isVowelICombLigaNormal:V(),isZhuyinCombLigaNormal:W('"Zhuyin Kaiti"',"ㆴ͘","󳆴"),isCombLigaNormal:V()(),substVowelCombLiga:Z(a.TYPESET["display-as"]["comb-liga-vowel"]),substZhuyinCombLiga:Z(a.TYPESET["display-as"]["comb-liga-zhuyin"]),substCombLigaWithPUA:Z(a.TYPESET["display-as"]["comb-liga-pua"]),substInaccurateChar:function(e){e=e||t;var n=a.find(e);n.avoid(Y),a.TYPESET["inaccurate-char"].forEach(function(e){n.replace(new RegExp(e[0],"ig"),e[1])})}}),s.extend(a.fn,{"comb-liga-vowel":null,"comb-liga-vowel-i":null,"comb-liga-zhuyin":null,"inaccurate-char":null,substVowelCombLiga:function(){return this["comb-liga-vowel"]=a.substVowelCombLiga(this.context),this},substVowelICombLiga:function(){return this["comb-liga-vowel-i"]=a.substVowelICombLiga(this.context),this},substZhuyinCombLiga:function(){return this["comb-liga-zhuyin"]=a.substZhuyinCombLiga(this.context),this},substCombLigaWithPUA:function(){return a.isVowelCombLigaNormal()?a.isVowelICombLigaNormal()||(this["comb-liga-vowel-i"]=a.substVowelICombLiga(this.context)):this["comb-liga-vowel"]=a.substVowelCombLiga(this.context),a.isZhuyinCombLigaNormal()||(this["comb-liga-zhuyin"]=a.substZhuyinCombLiga(this.context)),this},revertVowelCombLiga:function(){try{this["comb-liga-vowel"].revert("all")}catch(e){}return this},revertVowelICombLiga:function(){try{this["comb-liga-vowel-i"].revert("all")}catch(e){}return this},revertZhuyinCombLiga:function(){try{this["comb-liga-zhuyin"].revert("all")}catch(e){}return this},revertCombLigaWithPUA:function(){try{this["comb-liga-vowel"].revert("all"),this["comb-liga-vowel-i"].revert("all"),this["comb-liga-zhuyin"].revert("all")}catch(e){}return this},substInaccurateChar:function(){return this["inaccurate-char"]=a.substInaccurateChar(this.context),this},revertInaccurateChar:function(){try{this["inaccurate-char"].revert("all")}catch(e){}return this}}),e.addEventListener("DOMContentLoaded",function(){var e;i.classList.contains("han-init")?a.init():(e=t.querySelector(".han-init-context"))&&(a.init=a(e).render())}),void 0!==n&&!1!==n||(e.Han=a),a});